
* Source code
~~~
Windows : https://sourceforge.net/projects/sevenzip/files/7-Zip/
Linux : https://sourceforge.net/projects/p7zip/files/p7zip/
~~~

* 编译 -Windows
~~~
Visual Studio 2012+

1. 进入 CPP\7zip\Bundles\Format7zF

2.选择解决方案里的”7Z“项目后，点击菜单栏的”项目“->”生成自定义“，勾选”masm“，按”确定“
 选中项目里的 ASM\7zCrcOpt.asm 和 ASM\AesOpt.asm，右键”属性“->”常规“->”项类型“，选择 ”Microsoft Macro Assembler“，按”确定“,这点只对 x86 平台有效
 或者
 也可以去掉 asm 这种优化方式，去掉工程里这几个 asm 文件，把等价的 c 实现添加到工程。包括：
 ..\..\..\..\C\7zCrcOpt.c ， ..\..\..\..\C\AesOpt.c  并对这两个文件设置【不使用预编译头】。
	
3. "链接器"->"映像具有安全异常处理程序" => "否"

4. C/C++ -> 常规 -> 调试信息格式 => 程序数据库 (/Zi)

5. 链接器 -> 常规-> 输出文件 => .\Debug\7z.dll
~~~

* 与 7z 接口交互注意 CPropVariant

7z 代码中，接口交换数据时，`CPropVariant` 类，即使传递 `const char *` ， 也会转为 `BSTR` ，而且
转换的过程是直接字符 `assign` 复制，完全没考虑中文转换。所以，建议与之交互使用 `BSTR` 即可，`const char *` 转 `const wchar_t *` 在自己这边做。



* 编译 -Linux

make 7z -j8

格外注意 IUnknown 的实现，在 linux 平台，调用者和 7z 内部两者对 IUnknown 的实现可能不一样，会导致调用接口中的函数失败。
7z 对 IUnknown 增加了虚析构。

* 调试 Debug -Linux
~~~
makefile.machine 去掉 OPTFLAGS ，或者改为 OPTFLAGS=-g2
-DNDEBUG => -DDEBUG -D_DEBUG -g 
~~~


* 如何删除一个文件
~~~
https://sourceforge.net/p/sevenzip/discussion/45798/thread/0334c6d0/
archive with 3 files:
1.txt
2.txt
3.txt
You want to delete 2.txt
So new archive will contain 2 files.
UpdateItems(numItems = 2)
GetUpdateItemInfo()
if (index == 0)
*newData = 0;
*newProps = 0;
*indexInArchive = 0;
if (index == 1)
*newData = 0;
*newProps = 0;
*indexInArchive = 2;

情景2
archive with 3 files:
1.txt
2.txt
3.txt
You want to delete 1.txt and 2.txt
So new archive will contain 1 file.
UpdateItems(numItems = 1)
GetUpdateItemInfo()
if (index == 0)
*newData = 0;
*newProps = 0;
*indexInArchive = 2; // it's index of 3.txt in original archive
~~~

* 能否 InArchive 和 OutArchive 都使用同一个文件？也就是说，更新文件时，不借助其他文件（比如临时文件）。
~~~
不能。
https://sourceforge.net/p/sevenzip/discussion/45798/thread/fbcee7f0/
作者批示：
Original input stream must be readonly.
So you can't use same stream as OutSrtream.
~~~